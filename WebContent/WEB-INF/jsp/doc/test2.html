<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
        <!DOCTYPE html>
        

<HTML>
<HEAD>
	<TITLE> ZTREE DEMO - Standard Data - test</TITLE>
	<meta http-equiv="content-type" content="text/html; charset=UTF-8">
	<link rel="stylesheet" href="<%=request.getContextPath() %>/resources/css/zTreeCss/zTreeStyle/zTreeStyle.css" type="text/css">
<!--
	<link rel="stylesheet" href="<%=request.getContextPath() %>/resources/css/zTreeCss/demo.css" type="text/css">
  -->
    <script type="text/javascript" src="<%=request.getContextPath() %>script/jquery.ztree.excheck-3.5.js"></script>
	<script type="text/javascript" src="<%=request.getContextPath() %>/resources/js/zTreeJs/jquery-1.4.4.min.js"></script>
	<script type="text/javascript" src="<%=request.getContextPath() %>/resources/js/zTreeJs/jquery.ztree.core-3.5.js"></script>



<script type="text/javascript">
//var nodeIcon = "images/4.png";
//var groupIcon = "images/1_open.png";

function initTree(){
	var setting = {
		check: {
			enable: true
		},
		data: {
			simpleData: {
				enable: true
			}
		},
		async: {
			enable: true,
			url:"http://localhost:8080/spring_user/doc/test",
			//url:"test.jsp",
			dataType: "text",
			dataFilter: ajaxDataFilter,
			autoParam:["id"]
		}
	};
	
 	/***/
	var zNodes =[		
		{id:"userGroup:__ALL__", name:"全部用户组", open:true},
		{pId:"userGroup:__ALL__", id:"userGroup:001", name:"用户组_001", isParent:true, open:false },
		{pId:"userGroup:__ALL__", id:"userGroup:002", name:"用户组_002", isParent:true, open:false },
		{pId:"userGroup:__ALL__", id:"hostGroup:001", name:"设备组_001", isParent:true, open:false },
		{pId:"userGroup:__ALL__", id:"hostGroup:002", name:"设备组_002", isParent:true, open:false }
	];
	/***/
	
	$.fn.zTree.init($("#myTree"), setting, zNodes);
}

function ajaxDataFilter(treeId, parentNode, data) {
	//alert(data);
	//alert( $(data).attr("count"));
	var array = [];
	//var jsonp = $.parseJSON(childNodes);
	//var nc = parseInt($(jsonp).attr("count"));
	var nc = parseInt($(data).attr("count"));	
	var _pId = parentNode.id;
	var _id = null;
	var _name = null;	
	
	//alert($(data).attr("id["+ i +"]"));
	//alert("nc:"+nc);
	//alert(parentNode.id);
	for(var i=0; i<nc; i++){	
		//item = {pId:parentNode.id, id:$(jsonp).attr("id["+ i +"]"), name:$(jsonp).attr("name["+ i +"]"), isParent:false, open:true};
		//item = {pId:parentNode.id, id:"test:"+i, name:"test_"+i, isParent:false, open:true};
		_id = $(data).attr("id["+ i +"]");
		_name = $(data).attr("name["+ i +"]");
				
		array[i] = {pId:_pId, id:_id, name:_name, isParent:false, open:true, icon:nodeIcon};		
	}
	
	return array;
}

function old_ajaxDataFilter(treeId, parentNode, childNodes) {
	//alert(childNodes);
	var txt = "";
	var jsonp = $.parseJSON(childNodes);
	var nc = parseInt($(jsonp).attr("count"));
			
	for(var i=0; i<nc; i++){
		txt += $(jsonp).attr("id["+ i +"]") + "<br/>";
	}
	alert(txt);	

	return null;
}

$(document).ready(function(){
	initTree();
});
</script>

<style type="text/css">
.div_frame{
	width:800px;
	border: 1px solid #a5a4a4;
}	

.div_tree{
	width:300px;
	height:200px;
	overflow:auto;
	border: 1px solid #a5a4a4;	
}
</style>
</HEAD>

<body>
<div class="div_frame">
	<div class="div_tree">
		<ul id="myTree" class="ztree"></ul>
	</div>
</div>
</body>
</html>